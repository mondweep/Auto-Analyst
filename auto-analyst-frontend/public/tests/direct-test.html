<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Gemini API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            color: #2a2a7a;
        }
        #result {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            min-height: 200px;
            white-space: pre-wrap;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Direct Gemini API Test</h1>
    <p>This page directly tests the Gemini API without needing the chat interface.</p>
    
    <div>
        <h2>Test Input</h2>
        <textarea id="prompt" placeholder="Enter your test prompt here...">Analyze this automotive data: 
        
The inventory includes:
- Toyota Camry (2021), $28,500, excellent condition, 32,000 miles
- Honda Civic (2022), $24,700, good condition, 18,000 miles
- Ford F-150 (2020), $38,900, good condition, 45,000 miles

Market analysis shows:
- Toyota Camry market price: $30,200 (yours is $1,700 below market)
- Honda Civic market price: $25,900 (yours is $1,200 below market)
- Ford F-150 market price: $36,700 (yours is $2,200 above market)

What pricing recommendations would you make?</textarea>
        <br>
        <button id="testBtn">Run Gemini Test</button>
    </div>
    
    <div>
        <h2>Test Result</h2>
        <div id="status"></div>
        <pre id="result">Results will appear here...</pre>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const testBtn = document.getElementById('testBtn');
            const promptInput = document.getElementById('prompt');
            const resultOutput = document.getElementById('result');
            const statusDiv = document.getElementById('status');
            
            testBtn.addEventListener('click', async function() {
                testBtn.disabled = true;
                statusDiv.innerHTML = '<span class="loading"></span> Testing Gemini API...';
                resultOutput.textContent = 'Sending request...';
                
                try {
                    // Note: This is a direct test that doesn't use the model provider
                    // In a real app, this would use the appropriate API client
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: promptInput.value,
                            history: [],
                            model: 'gemini-pro',
                            temperature: 0.7,
                            maxTokens: 1000
                        }),
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API request failed with status ${response.status}: ${errorText}`);
                    }
                    
                    const data = await response.json();
                    
                    statusDiv.innerHTML = '<span class="success">✓ Test successful!</span>';
                    resultOutput.textContent = JSON.stringify(data, null, 2);
                } catch (error) {
                    statusDiv.innerHTML = `<span class="error">✗ Test failed:</span> ${error.message}`;
                    
                    // If we got connection refused, provide a helpful message
                    if (error.message.includes('fetch failed') || error.message.includes('NetworkError')) {
                        resultOutput.textContent = `Connection error: Could not reach the API endpoint.

Possible reasons:
1. The backend API server is not running
2. There is a CORS issue blocking the request
3. The API route is not correctly configured

Since we've been working on fallback implementations, let's run a simulation test instead of a real API call.

Simulating response based on the prompt...`;

                        // After a short delay, provide a simulated response
                        setTimeout(() => {
                            const simulatedResponse = simulateGeminiResponse(promptInput.value);
                            resultOutput.textContent += `\n\nSimulated Response:\n${simulatedResponse}`;
                            statusDiv.innerHTML = '<span class="success">✓ Simulation completed</span> (No actual API call made)';
                        }, 2000);
                    } else {
                        resultOutput.textContent = error.stack || error.message;
                    }
                } finally {
                    testBtn.disabled = false;
                }
            });
            
            // Function to simulate a Gemini response for testing purposes
            function simulateGeminiResponse(prompt) {
                // Basic logic to detect what the question is asking
                const lowerPrompt = prompt.toLowerCase();
                
                if (lowerPrompt.includes('pricing') && lowerPrompt.includes('recommend')) {
                    return `Based on the automotive data provided, here are my pricing recommendations:

1. Toyota Camry (2021): Your price of $28,500 is already $1,700 below market value ($30,200). This is a good competitive price that should attract buyers while still providing reasonable profit. No change recommended unless you need to increase inventory turnover rate.

2. Honda Civic (2022): Your price of $24,700 is $1,200 below market value ($25,900). Similar to the Camry, this is already competitively priced. The Civic is a newer model with low mileage in good condition, so it should sell well at this price point.

3. Ford F-150 (2020): Your price of $38,900 is $2,200 above market value ($36,700). This presents an opportunity for adjustment. I recommend reducing the price to match or slightly undercut the market value, perhaps to $36,500. The F-150 has higher mileage than the other vehicles, which may make it harder to sell at a premium.

General recommendations:
- Monitor how quickly each vehicle sells at current pricing
- Consider seasonal adjustments based on demand patterns
- For vehicles priced below market, ensure you're highlighting this value in your marketing
- For the F-150, either adjust pricing downward or clearly communicate the added value that justifies the premium price

These adjustments should help optimize your inventory turnover while maintaining healthy profit margins.`;
                } else if (lowerPrompt.includes('inventory') || lowerPrompt.includes('vehicles')) {
                    return `Based on the provided data, your current inventory includes:

1. Toyota Camry (2021)
   - Price: $28,500
   - Condition: Excellent
   - Mileage: 32,000 miles

2. Honda Civic (2022)
   - Price: $24,700
   - Condition: Good
   - Mileage: 18,000 miles

3. Ford F-150 (2020)
   - Price: $38,900
   - Condition: Good
   - Mileage: 45,000 miles

This is a balanced inventory with a compact car (Civic), a midsize sedan (Camry), and a full-size truck (F-150), covering different market segments and price points.`;
                } else {
                    return `I've analyzed the automotive data you've provided:

The inventory consists of three vehicles:
- A 2021 Toyota Camry in excellent condition priced at $28,500 with 32,000 miles
- A 2022 Honda Civic in good condition priced at $24,700 with 18,000 miles
- A 2020 Ford F-150 in good condition priced at $38,900 with 45,000 miles

Market analysis reveals:
- The Camry is priced $1,700 below market value
- The Civic is priced $1,200 below market value
- The F-150 is priced $2,200 above market value

Both the Toyota and Honda are competitively priced, which should help attract customers and potentially lead to quicker sales. The Ford F-150 may present a challenge as it's priced significantly above market value.

Would you like specific recommendations about pricing adjustments or marketing strategies for these vehicles?`;
                }
            }
        });
    </script>
</body>
</html> 